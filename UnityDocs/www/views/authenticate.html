
<div id="authenticate" data-role="view" data-model="authenticateViewModel" data-bind="events: { show: onViewShow }" data-layout="auth-layout" data-swipe-to-open="false">
    <div>
        <div class="center-text">
            <h1>Unity Docs</h1>
            <img src="images/SCL.ICO" />
            <h2>Sign In</h2>
        </div>
        <form name="auth-form">
            <ul data-role="listview" data-style="inset">
                <li>
                    <label>
                        Username
                        <input name="username" placeholder="Username" type="text" data-bind="value:credentials.username" />
                    </label>
                </li>
                <li>
                    <label>
                        Password
                        <input name="password" placeholder="Password" type="password" data-bind="value:credentials.password" />
                    </label>
                </li>
                <li>
                    <label>
                        Connection
                        <select name="connectionname" data-bind="value:credentials.connectionname, source: connectionItems"></select>
                    </label>
                </li>
            </ul>
        </form>
        <div class="error-message" data-bind="visible:error.visible, text:error.message">
        </div>
        <br />
        <div class="center-text">
            <button data-role="button" class="km-primary" data-bind="click:authenticate">Sign In</button>
        </div>
    </div>

</div>

<!-- View Model -->
<script>
    var authenticateViewModel = {};
    $(function (jQuery) {
        debugger;
        authenticateViewModel = new kendo.observable({
            credentials: { username: "", password: "", connectionname: "" },
            connectionItems: ['lmw', 'ute1'],
            onViewShow: function (e) {
                if (api.authService().isAutoLogin()) {
                    api.authService().authenticate(currentUser.get()).then(this.gotLogInResult);
                }
                globalOnViewShow(e);
            },
            authenticate: function () {
                if (typeof this.credentials != 'undefined') {
                    api.authService().authenticate(this.credentials).then(this.gotLogInResult);
                }
            },
            gotLogInResult: function (result) {
                if (result.LoggedIn) {
                    router.navigate("views/libraries.html");
                } else {
                    this.set("error", { visible: true, message: result.ErrorMessage });
                }
            }
        });
    })
</script>