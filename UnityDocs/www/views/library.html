<div id="library" data-reload="true" data-role="view" data-layout="default-layout" data-title="Library">
    <ul data-role="listview" class="data-source sortable" data-template="library-item-template" data-source="scope.data" data-pull-to-refresh="true"></ul>
</div>

<div data-role="modalview" id="info-modal" style="width: 100%; height: 100%;" data-modal="false">
    <div data-role="header">
        <div data-role="navbar">
            <a data-align="right" data-click="closeModalView" data-role="button">Delete</a>
            <span data-role="view-title"></span>
            <a data-align="left" data-click="closeModalView" data-role="button"><i class="fa fa-chevron-left"></i></a>
        </div>
    </div>
    <form action="./index.html">
        <ul data-role="listview" data-style="inset">
            <li>
                <label>
                    Type
                    <input data-field="Type" type="text" readonly />
                </label>
            </li>
            <li>
                <label>
                    Name
                    <input data-field="Description" type="text" readonly />
                </label>
            </li>
            <li>
                <label>
                    Modified
                    <input data-field="Modified" type="text" readonly />
                </label>
            </li>
            <li>
                <label>
                    Modified By
                    <input data-field="ModifiedBy" type="text" readonly />
                </label>
            </li>
            <li>
                <label>
                    Checked Out By
                    <input data-field="CheckedOutByFullName" type="text" readonly />
                </label>
            </li>
            <li>
                <label>
                    Tags <a data-role="button" href="#tag-info" data-rel="popover"><i class="fa fa-question"></i></a>
                    <input data-field="Tags" type="text" />
                </label>
            </li>
        </ul>
    </form>
    <div data-role="footer">
        <div data-role="navbar">
            <a data-align="right" data-click="closeModalView" data-role="button">Version History</a>
            <a data-align="right" data-click="closeModalView" data-role="button">Done</a>
        </div>
    </div>
    <div id="tag-info" data-role="popover">
        <div data-role="view">
            A string with each tag delimited by a ; (semi-colon).
        </div>
    </div>
</div>



<div data-role="modalview" id="version-history" style="width:100%; height:100%;" data-modal="false">

</div>

<!-- List Item template -->
<script type="text/kendo-x-tmpl" id="library-item-template">
    <a data-role="button" class="km-primary km-button-right km-icon-button" data-click="openInfoModal" data-description="#:Description#"><i class="fa fa-info"></i></a>
    <a href="\\#views/file.html?imageID=#:ImageID#&description=#:Description#&libraryName=#:scope.libraryName#" class="library-link">
        # if (Type == 'FOLDER') { #
        <i class="km-thumbnail fa fa-folder font-size-36"></i>
        # } else if (Type == 'DOCX' || Type == 'DOC') { #
        <i class="km-thumbnail fa fa-file-word-o font-size-36"></i>
        # } else if (Type == 'PNG' || Type == 'JPG' || Type == 'TIF') { #
        <i class="km-thumbnail fa fa-file-image-o font-size-36"></i>
        # } else if (Type == 'XLSM' || Type == 'XLS' || Type == 'XLSX') { #
        <i class="km-thumbnail fa fa-file-excel-o font-size-36"></i>
        # } else if (Type == 'PDF') { #
        <i class="km-thumbnail fa fa-file-pdf-o font-size-36"></i>
        # } else if (Type == 'TXT') { #
        <i class="km-thumbnail fa fa-file-text-o font-size-36"></i>
        # } else { #
        <i class="km-thumbnail fa fa-file-o font-size-36"></i>
        # } #

        <h4>#:Description#</h4>

        <p class="extra-info">Last modified at #:Modified# by #:ModifiedBy#.</p>
        # if (CheckedOutBy == null){ #
        <p class="extra-info">
            # if (Type == 'FOLDER') {#
            &nbsp;
            # } else { #
            Checked Out By: Nobody.
            # } #
        </p>
        # } else { #
        <p class="extra-info">
            # if (Type == 'FOLDER') {#
            &nbsp;
            # } else { #
            Checked Out By: #:CheckedOutBy#.
            # } #
        </p>
        # } #
    </a>

</script>

<script>
    function closeModalView(e) {
        // find the closest modal view, relative to the button element.
        var modalView = e.sender.element.closest("[data-role=modalview]").data("kendoMobileModalView");
        modalView.close();
    }

    function openInfoModal(e) {
        var modalView = $("#info-modal").data("kendoMobileModalView");
        var data = e.button.data();
        var libs = scope.data.data();
        for (var x = 0; x < libs.length; x++) {
            var library = libs[x];
            if (library.Description == data.description) {
                break;
            }
        }
        for (var prop in library) {
            if (library.hasOwnProperty(prop)) {
                if ($("[data-field=" + prop + "]").exists()) {
                    $("[data-field=" + prop + "]").val(library[prop]);
                }
            }
        }
        $("#info-modal [data-role=view-title]").text(data.description);
        modalView.open();
    }

    function deleteFolder() {
        var folderName = $("#info-modal [data-field=Description]").val();

        var libraryName = scope.libraryName;

        api.documentService().removeFolderFromLibrary(scope.libraryName, folderName).then(function (results) {
            debugger;

        })
        debugger;
    }

    function openFile(e) {
        console.log("opening");
        var item = e.item.children("a");
        var data = item.data();
        var type = data.type;
        if (type != "FOLDER") {
            var docID = data.documentid;
            var fileName = data.description;
            api.documentService().openDocument(testFiles.convertToTestFile(fileName));
        }
    }
</script>
