<div id="library" data-reload="true" data-role="view" data-layout="default-layout" data-title="Library">
    <ul data-role="listview" data-click="openFile" class="data-source sortable" data-template="library-item-template" data-source="scope.data" data-pull-to-refresh="true">

    </ul>
</div>

<div data-role="modalview" id="info-modal" style="width: 100%; height: 100%;" data-modal="false">
    <div data-role="header">
        <div data-role="navbar">
            <span data-role="view-title"></span>
        </div>
    </div>
    <form action="./index.html">
        <ul data-role="listview" data-style="inset">
            <li>
                <label>
                    Type
                    <input data-field="Type" type="text" readonly />
                </label>
            </li>
            <li>
                <label>
                    Name
                    <input data-field="Description" type="text" readonly />
                </label>
            </li>
            <li>
                <label>
                    Modified
                    <input data-field="Modified" type="text" readonly />
                </label>
            </li>
            <li>
                <label>
                    Modified By
                    <input data-field="ModifiedBy" type="text" readonly />
                </label>
            </li>
            <li>
                <label>
                    Checked Out By
                    <input data-field="CheckedOutByFullName" type="text" readonly />
                </label>
            </li>
            <li>
                <label>
                    Tags
                    <input data-field="Tags" type="text" readonly />
                </label>
            </li>
        </ul>
    </form>
    <ul data-role="buttongroup">
        <li data-click="deleteFolder">Delete</li>
        <li>Open</li>
    </ul>
    <div data-role="footer">
        <div data-role="navbar">
            <a data-align="right" data-click="closeModalView" data-role="button">Cancel</a>
            <a data-align="right" data-click="closeModalView" data-role="button">Save</a>
        </div>
    </div>
</div>

<!-- List Item template -->
<script type="text/kendo-x-tmpl" id="library-item-template">
    <a data-documentid="#:ImageID#" data-description="#:Description#">
        # if (Type == 'FOLDER') { #
            <i class="fa fa-folder font-size-36"></i>
        # } else if (Type == 'DOCX' || Type == 'DOC') { #
            <i class="fa fa-file-word-o font-size-36"></i>
        # } else if (Type == 'PNG' || Type == 'JPG' || Type == 'TIF') { #
            <i class="fa fa-file-image-o font-size-36"></i>
        # } else if (Type == 'XLSM' || Type == 'XLS' || Type == 'XLSX') { #
            <i class="fa fa-file-excel-o font-size-36"></i>
        # } else if (Type == 'PDF') { #
            <i class="fa fa-file-pdf-o font-size-36"></i>
        # } else if (Type == 'TXT') { #
            <i class="fa fa-file-text-o font-size-36"></i>
        # } else { #
            <i class="fa fa-file-o font-size-36"></i>
        # } #
        #:Description#
    </a>
    <button data-role="detailbutton" data-click="openInfoModal" data-description="#:Description#" data-icon="more-h" style="padding:3px;"></button>
</script>

<script>
    function closeModalView(e) {
        // find the closest modal view, relative to the button element.
        var modalView = e.sender.element.closest("[data-role=modalview]").data("kendoMobileModalView");
        modalView.close();
    }

    function openInfoModal(e) {
        var modalView = $("#info-modal").data("kendoMobileModalView");
        var data = e.button.data();
        var libs = scope.data.data();
        for (var x = 0; x < libs.length; x++) {
            var library = libs[x];
            if (library.Description == data.description) {
                break;
            }
        }
        for (var prop in library) {
            if (library.hasOwnProperty(prop)) {
                if ($("[data-field=" + prop + "]").exists()) {
                    $("[data-field=" + prop + "]").val(library[prop]);
                }
            }
        }
        $("#info-modal [data-role=view-title]").text(data.description);
        modalView.open();
    }

    function deleteFolder() {
        var folderName = $("#info-modal [data-field=Description]").val();

        var libraryName = scope.libraryName;

        api.documentService().removeFolderFromLibrary(scope.libraryName, folderName).then(function (results) {
            debugger;

        })
        debugger;
    }
    function openFile(e) {
        var item = e.item.children("a");
        var data = item.data();
        var docID = data.documentid;
        var fileName = data.description;
        
        api.documentService().openDocument(testFiles.convertToTestFile(fileName));
    }
</script>

