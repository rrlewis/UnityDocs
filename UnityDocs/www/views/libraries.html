<div id="libraries" data-reload="true" data-role="view" data-layout="default-layout" data-title="Libraries" data-init="loadData">
    <header data-role="header">
        <div data-role="navbar">
            <a data-role="backbutton" data-align="left" id="logout-button"><i class="fa fa-sign-out"></i></a>
            <span data-role="view-title" id="view-title">Unity Docs</span>
        </div>
    </header>
    <ul data-role="listview" class="data-source sortable" data-template="library-template" data-source="scope.data" data-pull-to-refresh="true">
        <li>Empty</li>
    </ul>
</div>

<div data-role="modalview" id="edit-modal" style="width: 100%; height: 100%;" data-modal="false">
    <div data-role="header">
        <div data-role="navbar">
            <span data-role="view-title"></span>
        </div>
    </div>
    <form action="./index.html">
        <ul data-role="listview" data-style="inset">
            <li>
                <label>
                    Name
                    <input data-field="Name" type="text" />
                </label>

            </li>
            <li>
                <label>
                    Description
                    <input data-field="Description" type="text" />
                </label>
            </li>
            <li>
                <label>
                    Require content approval for submitting new items
                    <input data-field="RequireApproval" type="checkbox" />
                </label>
            </li>
            <li>
                <label>
                    Allow documents in this library to be searchable
                    <input data-field="IsSearchable" type="checkbox" />
                </label>
            </li>
            <li>
                <label>
                    Allow folders to be created
                    <input data-field="AllowFolders" type="checkbox" />
                </label>
            </li>
            <li>
                <label>
                    Enable versioning
                    <input data-field="IsVersioningAvailable" type="checkbox" />
                </label>
            </li>
            <li>
                <label>
                    Document Template
                    <input data-field="DocumentTemplate" type="text" />
                </label>

            </li>
        </ul>
    </form>
    <div data-role="footer">
        <div data-role="navbar">
            <a data-align="right" data-click="closeModalView" data-role="button">Cancel</a>
            <a data-align="right" data-click="closeModalView" data-role="button">Save</a>
        </div>
    </div>
</div>

<!-- List Item template -->
<script type="text/kendo-x-tmpl" id="library-template">

    <a href="\\#views/library.html?indextypeorlibrary=#:Name#&key&subfolder" data-rel="external">
        <i class="fa fa-database font-size-36"></i>
        #:Name#
    </a>
    <button data-role="detailbutton" style="padding:3px;" data-click="openEditModal" data-libName="#:Name#" data-icon="edit"></button>

</script>

<script>
    function closeModalView(e) {
        // find the closest modal view, relative to the button element.
        var modalView = e.sender.element.closest("[data-role=modalview]").data("kendoMobileModalView");
        modalView.close();
    }

    function openEditModal(e) {
        var data = e.button.data();
        var modalView = $("#edit-modal").data("kendoMobileModalView");
        var libraries = scope.data.data();
        var library;

        for (var x = 0; x < libraries.length; x++) {
            library = libraries[x];
            if (library.Name == data.libname) {
                break;
            }
        }

        api.documentService().getLibraryDetails(data.libname).then(function (results) {
            for (var prop in results.results) {
                if (results.results.hasOwnProperty(prop)) {
                    if ($("[data-field=" + prop + "]").exists()) {
                        if ($("[data-field=" + prop + "]").attr('type') == 'checkbox') {
                            $("[data-field=" + prop + "]").prop('checked', results.results[prop]);
                        } else {
                            $("[data-field=" + prop + "]").val(results.results[prop]);
                        }
                    }
                }
            }
            $("#edit-modal [data-role=view-title]").text(data.libname);
            modalView.open();
        })
    }
</script>