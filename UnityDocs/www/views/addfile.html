<div id="addfile" data-model="addfileViewModel" data-bind="events: { show: onViewShow }" data-role="view" data-layout="default-layout" data-title="Add File">
    <form>
        <ul data-role="listview">
            <li style="display:none;">
                <input type="file" id="addfile-file" data-bind="events: { change:onFileGet }" />
            </li>
            <!-- Hidden -->
            <li data-bind="visible:gotFile">
                <label>
                    Filename
                    <input type="text" data-bind="value:fileData.filename" />
                </label>
            </li>
            <li data-bind="visible:gotFile">
                <label>
                    Folder
                    <select data-bind="source:folderData, value:fileData.folder">

                    </select>
                </label>
            </li>
            <li data-bind="visible:gotFile">
                <label>
                    Comments
                    <textarea style="resize:vertical;" data-bind="value:fileData.comments"></textarea>
                </label>
            </li>
            <li data-bind="visible:gotFile">
                <label>
                    Tags
                    <input type="text" data-bind="value:fileData.tags" />
                </label>
            </li>
            <li data-bind="visible:gotFile">
                <label>
                    Check out file
                    <input type="checkbox" data-bind="value:fileData.checkoutfile" />
                </label>
            </li>
            <li data-bind="visible:gotFile">
                <div class="center-text">
                    <a data-role="button" data-bind="click:uploadFile" class="km-primary">Upload</a>
                </div>
            </li>
            <!-- ****** -->
            <li data-bind="invisible:gotFile">
                <div class="center-text">
                    <a data-role="button" data-bind="click:openFileDialog">Select File</a>
                </div>
            </li>

        </ul>
    </form>
</div>

<script>
    var addfileViewModel = {};
    $(function (jQuery) {
        addfileViewModel = new kendo.observable({
            filePath: "",
            folderData: [],
            fileData: {
                filename: "",
                comments: "",
                tags: "",
                folder: "",
                checkoutfile: false,
            },
            libraryName: "",
            gotFile: false,
            openFileDialog: function (e) {
                $("#addfile-file").click();
            },
            onFileGet: function (e) {
                //file selection done
                var input = $(e.target);
                var filePath = input.val();
                var fileName = filePath.split('\\').pop();
                this.set('fileData.filename', fileName);
                this.set('filePath', filePath);
                this.set('gotFile', true);
            },
            uploadFile: function () {
                // upload file to server in the directory where upload was pressed.
                var formData = $("#addfile form").data();
                debugger;

            },
            onViewShow: function (e) {
                debugger;
                var params = e.view.params;
                // get library folders.
                var $this = this;
                this.set('libraryName', params.libraryName);
                api.documentService().getFolderList(params.libraryName).then(function (response) {
                    var results = response.results;
                    $this.set('folderData', results);
                });
                $("#addfile-file").click();
                globalOnViewShow(e);
            },
        });
    });
</script>
