<div id="addfile" data-model="addfileViewModel" data-bind="events: { show: onViewShow }" data-role="view" data-layout="default-layout" data-title="Add File">
    <form action="http://apprentice2/unity/api/documentmanagement/UploadDocument" method="post">
        <ul data-role="listview">
            <li style="display:none;">
                <input type="file" capture accept="image/*" id="addfile-file" data-bind="events: { change:onFileGet }">
            </li>
            <!-- Hidden -->
            <li data-bind="visible:gotFile">
                <label>
                    Filename
                    <input type="text" data-bind="value:fileData.FileName" />
                </label>
            </li>
            <li data-bind="visible:gotFile">
                <label>
                    Folder
                    <select data-bind="source:folderData, value:fileData.Folder"></select>
                </label>
            </li>
            <li data-bind="visible:gotFile">
                <label>
                    Comments
                    <textarea style="resize:vertical;max-height:200px;" data-bind="value:fileData.VersionComments"></textarea>
                </label>
            </li>
            <li data-bind="visible:gotFile">
                <label>
                    Tags
                    <input type="text" data-bind="value:fileData.Tags" />
                </label>
            </li>
            <li data-bind="visible:gotFile">
                <label>
                    Check out file
                    <input type="checkbox" data-bind="value:fileData.CheckoutAfterUpload" />
                </label>
            </li>
            <li data-bind="visible:gotFile">
                <div class="center-text">
                    <a data-role="button" data-bind="click:uploadFile" class="km-primary">Upload</a>
                </div>
            </li>
        </ul>
    </form>
    <a data-role="button" class="add-file" data-bind="click:openFileActionSheet,invisible:gotFile"><i class="fa fa-plus"></i>&nbsp;Add File</a>
</div>

<script>
    var addfileViewModel = {};

    $(function (jQuery) {
        addfileViewModel = new kendo.observable({
            defaults: [
                    ['filePath', ""],
                    ['folderData', []],
                    ['fileData', {
                        FileName: "",
                        VersionComments: "",
                        Tags: "",
                        Folder: "",
                        CheckoutAfterUpload: false,
                    }
                    ],
                    ['libraryName', ""],
                    ['gotFile', false]
            ],
            filePath: "",
            folderData: [],
            fileData: {
                FileName: "",
                VersionComments: "",
                Tags: "",
                Folder: "",
                CheckoutAfterUpload: false,
            },
            libraryName: "",
            gotFile: false,
            openFileActionSheet: function (e) {
                var $this = this;
                var options = {
                    'androidTheme': window.plugins.actionsheet.ANDROID_THEMES.THEME_HOLO_LIGHT, // default is THEME_TRADITIONAL
                    'title': 'Where would you like to add a file from?',
                    'buttonLabels': ['Camera', 'Storage'],
                    'androidEnableCancelButton': true, // default false
                    'addCancelButtonWithLabel': 'Cancel',
                };
                window.plugins.actionsheet.show(options, function (buttonIndex) {
                    setTimeout(function () {
                        var buttonPressed = options.buttonLabels[buttonIndex - 1];
                        switch (buttonPressed) {
                            case 'Camera':
                                function gotPicture(a,b,c) {
                                    function uploadSuccess(a, b, c) {
                                        debugger;
                                    }
                                    function uploadFail(a, b, c) {
                                        debugger;
                                    }
                                    debugger;
                                }
                                function failedToGetPicture(a, b, c) {
                                    debugger;
                                }

                                navigator.camera.getPicture(gotPicture, failedToGetPicture, {
                                    quality: 50, destinationType: Camera.DestinationType.FILE_URI
                                });

                                break;
                            case 'Storage':
                                $this.openFileDialog(e);
                                break;
                        }
                    });
                });
            },
            openFileDialog: function (e) {
                $("#addfile-file").click();
            },
            onFileGet: function (e) {
                //file selection done
                var input = $(e.target);
                var filePath = input.val();

                var fileName = filePath.split('\\').pop();
                this.set('fileData.FileName', fileName);
                this.set('filePath', filePath);
                this.set('gotFile', true);
            },
            uploadFile: function () {
                // upload file to server in the directory where upload was pressed.
                var form = $("#addfile form");
                var formData = {};

                formData.FileName = this.fileData.FileName;
                formData.VersionComments = this.fileData.VersionComments;
                formData.Tags = this.fileData.Tags;
                formData.Folder = this.fileData.Folder;
                formData.CheckoutAfterUpload = this.CheckoutAfterUpload;

                form.formData = formData;
                debugger;
                form.submit(function (result) {
                    debugger;
                });
                debugger;

            },
            onViewShow: function (e) {
                this.reset();
                var params = e.view.params;
                // get library folders.
                var $this = this;
                this.set('libraryName', params.libraryName);
                api.documentService().getFolderList(params.libraryName).then(function (response) {
                    var results = response.results;
                    $this.set('folderData', results);
                });
                globalOnViewShow(e);
            },
            reset: function (e) {
                for (var x = 0; x < this.defaults.length; x++) {
                    var propName = this.defaults[x][0];
                    var propVal = this.defaults[x][1];
                    if (this.hasOwnProperty(propName)) {
                        this.set(propName, propVal);
                    }
                }
            }
        });
    });
</script>

<style>
    #addfile [data-role=content] {
    }

    #addfile .add-file {
        padding: 0;
        border: 0;
        height: 100%;
        box-sizing: border-box;
        margin: 0;
        width: 100%;
        line-height: 80vh;
        font-weight: 900;
        font-size: 28px;
    }

    #addfile .km-scroll-container {
        box-sizing: border-box;
        height: 100%;
        position: absolute;
        width: 100%;
    }
</style>